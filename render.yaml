# Render.com Blueprint - Complete Infrastructure as Code
# This file defines all services needed for the Organic Veg Order System
# Deploy: Push to GitHub, then Render Dashboard → New → Blueprint

services:
  # ==============================================
  # BACKEND API SERVICE
  # ==============================================
  - type: web
    name: organic-veg-api
    runtime: node
    region: frankfurt
    plan: free
    rootDir: backend

    buildCommand: |
      npm install
      npm run build
      npx prisma generate
      npx prisma db push

    startCommand: npm start

    healthCheckPath: /api/health
    autoDeploy: true

    envVars:
      # Database - Auto-linked from PostgreSQL below
      - key: DATABASE_URL
        fromDatabase:
          name: organic-veg-db
          property: connectionString

      # JWT Configuration
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_ACCESS_EXPIRY
        value: 15m
      - key: JWT_REFRESH_EXPIRY
        value: 7d

      # Server
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: CORS_ORIGIN
        sync: false # Set manually after Netlify deploy

      # File Storage
      - key: FILE_STORAGE_PATH
        value: ./uploads

      # WhatsApp (Optional - set in dashboard)
      - key: WHATSAPP_API_URL
        sync: false
      - key: WHATSAPP_API_TOKEN
        sync: false
      - key: WHATSAPP_PHONE_NUMBER_ID
        sync: false

      # SendGrid Email (Optional - set in dashboard)
      - key: SENDGRID_API_KEY
        sync: false
      - key: SENDGRID_FROM_EMAIL
        sync: false

# ==============================================
# POSTGRESQL DATABASE
# ==============================================
databases:
  - name: organic-veg-db
    region: frankfurt
    plan: free
    databaseName: organic_veg
    user: organic_veg_user
